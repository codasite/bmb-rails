<div class="bracket-container">
  <div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-md-10">
        <div class="bracket-card">
          <div class="bracket-header">
            <h1 class="bracket-title">üèÜ Create Tournament</h1>
            <p class="bracket-subtitle">Build your professional bracket in minutes</p>
          </div>
          <div class="bracket-form">
          <%= form_with(model: @bracket, local: true, class: "needs-validation", novalidate: true) do |form| %>
            <% if @bracket.errors.any? %>
              <div class="alert alert-danger">
                <h4><%= pluralize(@bracket.errors.count, "error") %> prohibited this bracket from being saved:</h4>
                <ul class="mb-0">
                  <% @bracket.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <%= form.label :title, class: "form-label" %>
                  <%= form.text_field :title, class: "form-control", placeholder: "e.g., March Madness 2024", required: true %>
                  <div class="invalid-feedback">Please provide a bracket title.</div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="mb-3">
                  <%= form.label :month, class: "form-label" %>
                  <%= form.select :month, 
                      options_for_select([
                        ['January', 'January'], ['February', 'February'], ['March', 'March'],
                        ['April', 'April'], ['May', 'May'], ['June', 'June'],
                        ['July', 'July'], ['August', 'August'], ['September', 'September'],
                        ['October', 'October'], ['November', 'November'], ['December', 'December']
                      ], Date.current.strftime('%B')), 
                      { prompt: 'Select month' }, 
                      { class: "form-select", required: true } %>
                </div>
              </div>
              <div class="col-md-3">
                <div class="mb-3">
                  <%= form.label :year, class: "form-label" %>
                  <%= form.number_field :year, class: "form-control", value: Date.current.year, min: Date.current.year, max: Date.current.year + 5, required: true %>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <%= form.label :num_teams, "Number of Teams", class: "form-label" %>
                  <%= form.select :num_teams, 
                      options_for_select([
                        ['4 teams', 4],
                        ['8 teams', 8],
                        ['16 teams', 16],
                        ['32 teams', 32],
                        ['64 teams', 64]
                      ], 16), 
                      { prompt: 'Select team count' }, 
                      { class: "form-select", required: true, id: "num_teams_select" } %>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <%= form.label :fee, "Entry Fee ($)", class: "form-label" %>
                  <%= form.number_field :fee, class: "form-control", step: 0.01, min: 0, placeholder: "0.00 (optional)" %>
                  <div class="form-text">Leave blank for free tournaments</div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <div class="form-check mt-4">
                    <%= form.check_box :is_voting, class: "form-check-input" %>
                    <%= form.label :is_voting, "Voting Bracket", class: "form-check-label" %>
                    <div class="form-text">Allow public voting on matchups</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="team-input-container">
              <h5 class="team-input-title">Team Names</h5>
              <p class="text-muted">Enter team names below, or leave blank to use default names (Team 1, Team 2, etc.)</p>
              <div id="team_names_container">
                <!-- Team name inputs will be generated by JavaScript -->
              </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mt-4 pt-3">
              <%= link_to 'Cancel', brackets_path, class: "btn-bracket-secondary" %>
              <%= form.submit "Create Tournament", class: "btn-bracket-primary" %>
            </div>
          <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const numTeamsSelect = document.getElementById('num_teams_select');
  const teamNamesContainer = document.getElementById('team_names_container');
  
  function generateTeamInputs() {
    const numTeams = parseInt(numTeamsSelect.value) || 0;
    teamNamesContainer.innerHTML = '';
    
    if (numTeams > 0) {
      const row = document.createElement('div');
      row.className = 'row';
      
      for (let i = 0; i < numTeams; i++) {
        const col = document.createElement('div');
        col.className = 'col-md-3 mb-2';
        
        const input = document.createElement('input');
        input.type = 'text';
        input.name = 'bracket[team_names][]';
        input.className = 'team-input';
        input.placeholder = `Team ${i + 1}`;
        
        const label = document.createElement('label');
        label.className = 'seed-label';
        label.textContent = `Seed ${i + 1}`;
        
        col.appendChild(label);
        col.appendChild(input);
        row.appendChild(col);
        
        // Start new row every 4 teams
        if ((i + 1) % 4 === 0 || i === numTeams - 1) {
          teamNamesContainer.appendChild(row);
          if (i < numTeams - 1) {
            row = document.createElement('div');
            row.className = 'row';
          }
        }
      }
    }
  }
  
  numTeamsSelect.addEventListener('change', generateTeamInputs);
  generateTeamInputs(); // Initialize on page load
});
</script>